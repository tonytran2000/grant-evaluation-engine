// Code Generated by Sidekick is for learning and experimentation purposes only.
import axios from 'axios';
import { Auth } from 'aws-amplify';

// -- Presigned URL (GrantAppPreSignUrl API, /presign-url, dev stage) --
const PRESIGN_URL = 'https://d4qbiao1mb.execute-api.us-east-2.amazonaws.com/dev/presign-url'; 

// -- Document Evaluation (AutomatedGrantEvalAPI, e.g. /evaluate, dev stage) --
const EVALUATE_URL = 'https://qjxg7tk0bd.execute-api.us-east-2.amazonaws.com/dev/evaluate';

export async function getPresignedUrl(fileName) {
  const token = (await Auth.currentSession()).getIdToken().getJwtToken();
  const { data } = await axios.get(`${PRESIGN_URL}?file=${encodeURIComponent(fileName)}`, {
    headers: { Authorization: token }
  });
  return data;
}

export async function uploadFileToS3(presignedUrl, file) {
  await axios.put(presignedUrl, file, {
    headers: { 'Content-Type': file.type }
  });
}

export async function evaluateDocument(bucket, key) {
  const token = (await Auth.currentSession()).getIdToken().getJwtToken();
  const { data } = await axios.post(EVALUATE_URL, { bucket, key }, {
    headers: { Authorization: token }
  });
  return data;
}
