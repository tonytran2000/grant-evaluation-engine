// Code Generated by Sidekick is for learning and experimentation purposes only.
import React, { useState } from 'react';
import { Authenticator } from '@aws-amplify/ui-react';
import '@aws-amplify/ui-react/styles.css';
import { getPresignedUrl, uploadFileToS3, evaluateDocument } from './api';

function App() {
  const [file, setFile] = useState(null);
  const [uploadStatus, setUploadStatus] = useState('');
  const [result, setResult] = useState(null);

  const handleFileChange = e => {
    setFile(e.target.files[0]);
    setResult(null);
  };

  const handleUpload = async () => {
    setUploadStatus('Requesting upload URL...');
    try {
      const { url, bucket, file: key } = await getPresignedUrl(file.name);
      setUploadStatus('Uploading to S3...');
      await uploadFileToS3(url, file);

      setUploadStatus('Evaluating eligibility...');
      const evalResult = await evaluateDocument(bucket, key);
      setResult(evalResult);
      setUploadStatus('Complete');
    } catch (e) {
      setUploadStatus('Error: ' + e.message);
    }
  };

  return (
    <Authenticator>
      {({ signOut, user }) => (
        <div style={{ maxWidth: 600, margin: 'auto', padding: 40, fontFamily: 'Arial, sans-serif' }}>
          <h2>Grant Evaluation Engine</h2>
          <p>Signed in as: {user.username} <button onClick={signOut}>Sign out</button></p>
          <input type="file" accept="application/pdf" onChange={handleFileChange} />
          <button disabled={!file} onClick={handleUpload} style={{ marginLeft: 8 }}>
            Upload and Evaluate
          </button>
          <div style={{ marginTop: 16 }}>{uploadStatus}</div>
          {result && (
            <div style={{ background: '#f5f5f5', marginTop: 24, padding: 16 }}>
              <h3>Eligibility Results</h3>
              <b>Score:</b> {result.score || '-'}<br />
              <b>Reason:</b> {result.reason || result.explanation || 'N/A'}
            </div>
          )}
        </div>
      )}
    </Authenticator>
  );
}

export default App;
